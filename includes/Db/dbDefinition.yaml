account:
  columns:
    accid: { type: int(10) unsigned, notnull: true, primary: true, autoincrement: true, comment: account id }
    name: { type: varchar(255), notnull: true, comment: account name }
  data:
    - { name: gaterdata }

application:
  columns:
    appid: { type: int(10) unsigned, notnull: true, primary: true, autoincrement: true, comment: application id }
    accid: { type: int(10) unsigned, notnull: true, comment: account id }
    name: { type: varchar(255), notnull: true, comment: application name }
  data:
    - { accid: 1, name: testing }
    - { accid: 1, name: core }

user:
  columns:
    uid: { type: int(10) unsigned, notnull: true, primary: true, autoincrement: true, comment: user id }
    active: { type: tinyint(4), notnull: true, default: 1, comment: user status }
    username: { type: varchar(255), notnull: true, comment: user name }
    hash: { type: varchar(64), default: NULL, comment: pasword hash }
    token: { type: varchar(32), default: NULL, comment: temporary access token }
    token_ttl: { type: timestamp, default: NULL, comment: end of life for token }
    email: { type: varchar(255), notnull: true, comment: user email address }
    honorific: { type: varchar(16), notnull: true, comment: users title }
    name_first: { type: varchar(255), notnull: true, comment: first name }
    name_last: { type: varchar(255), notnull: true, comment: last name }
    company: { type: varchar(255), default: NULL, comment: company name }
    website: { type: varchar(255), default: NULL, comment: company url }
    address_street: { type: varchar(255), default: NULL, comment: user number and street name }
    address_suburb: { type: varchar(255), default: NULL, comment: user address and suburb }
    address_city: { type: varchar(255), default: NULL, comment: user city }
    address_state: { type: varchar(255), default: NULL, comment: user state }
    address_country: { type: varchar(255), default: NULL, comment: user country }
    address_postcode: { type: varchar(16), default: NULL, comment: user postcode }
    phone_mobile: { type: varchar(32), default: NULL, comment: user mobile number }
    phone_work: { type: varchar(32), default: NULL, comment: user work number }

role:
  columns:
    rid: { type: int(10) unsigned, notnull: true, primary: true, autoincrement: true, comment: role id }
    name: { type: varchar(255), notnull: true, comment: title of role }
  data:
    - { name: Administrator }
    - { name: Account manager }
    - { name: Application manager }
    - { name: Developer }
    - { name: Consumer }

user_role:
  columns:
    urid: { type: int(10) unsigned, notnull: true, primary: true, autoincrement: true, comment: user role id }
    accid: { type: int(10) unsigned, notnull: false, comment: "account id, we allow null for owner role" }
    appid: { type: int(10) unsigned, notnull: false, comment: "application id, we allow null for owner role" }
    uid: { type: int(10) unsigned, notnull: true, comment: user id }
    rid: { type: int(10) unsigned, notnull: true, comment: role id }

invite:
  columns:
    iid: { type: int(10) unsigned, notnull: true, primary: true, autoincrement: true, comment: invite id }
    email: { type: varchar(255), default: true, comment: invite email address }
    token: { type: varchar(255), notnull: true, comment: invite token }

resource:
  columns:
    resid: { type: int(10) unsigned, notnull: true, primary: true, autoincrement: true, comment: resource id }
    appid: { type: int(10) unsigned, notnull: true, comment: application id }
    name: { type: varchar(255), notnull: true, comment: name of the resource }
    description : { type: varchar(2048), notnull: true, comment: description of the resource }
    method: { type: text, notnull: true, comment: form delivery method }
    uri: { type: varchar(64), notnull: true, comment: URI of the api call }
    meta: { type: varchar(16384), notnull: true, comment: all of the actions taken by the call }
    ttl: { type: int(10) unsigned, notnull: true, default: 300, comment: time to cache the results (seconds) }
  data:
    - { appid: 2, name: Account create/update, description: Create or update an account, method: post, uri: account, ttl: 0, meta: '{\"security\":{\"function\":\"token_role\",\"id\":\"security\",\"token\":{\"function\":\"bearer_token\",\"id\":\"security_token\"},\"role\":\"Administrator\"},\"process\":{\"function\":\"account\",\"id\":\"account\",\"accountName\":{\"function\":\"var_post\",\"id\":\"account_name\",\"key\":\"accountName\"},\"oldName\":{\"function\":\"var_post\",\"id\":\"account_old_name\",\"key\":\"oldName\"}}}' }
    - { appid: 2, name: Account delete, description: Delete an account, method: delete, uri: account, ttl: 0, meta: '{\"security\":{\"function\":\"token_role\",\"id\":\"account_delete_security\",\"token\":{\"function\":\"bearer_token\",\"id\":\"account_delete_bearer_token\"},\"role\":\"Administrator\"},\"process\":{\"function\":\"account\",\"id\":\"account_delete\",\"accountName\":{\"function\":\"var_uri\",\"id\":\"account_delete_account_name\",\"index\":0}}}' }
    - { appid: 2, name: Account read, description: Read an account, method: get, uri: account, ttl: 0, meta: '{\"security\":{\"function\":\"bearer_token\",\"id\":{\"roles\":[\"Administrator\",\"Account manager\",\"Application manager\",\"Developer\"]},\"token\":\"\"},\"process\":{\"function\":\"account\",\"id\":\"account\",\"accountName\":{\"function\":\"var_get\",\"id\":5,\"key\":\"accountName\"}}}' }
    - { appid: 2, name: Application create, description: Create an application, method: post, uri: application, ttl: 0, meta: '{\"security\":{\"function\":\"token_roles\",\"id\":\"application_create_security\",\"token\":{\"function\":\"bearer_token\",\"id\":\"application_create_token\"},\"roles\":[\"Administrator\",\"Account manager\"]},\"process\":{\"function\":\"application_create\",\"id\":\"application_create_process\",\"accid\":{\"function\":\"var_post\",\"id\":\"application_create_accid\",\"key\":\"accid\"},\"name\":{\"function\":\"var_post\",\"id\":\"application_create_name\",\"key\":\"name\"}}}' }
    - { appid: 2, name: Application delete, description: Delete an application, method: delete, uri: applicaton, ttl: 0, meta: '{\"security\":{\"function\":\"token_roles\",\"id\":\"application_delete_security\",\"token\":{\"function\":\"bearer_token\",\"id\":\"application_delete_token\"},\"roles\":[\"Administrator\",\"Account manager\"]},\"process\":{\"function\":\"application_delete\",\"id\":\"application_delete_process\",\"applicationId\":{\"function\":\"var_uri\",\"id\":\"application_delete_application_id\",\"index\":0}}}' }
    - { appid: 2, name: Application read, description: Fetch a single or multiple applications., method: get, uri: application, ttl: 0, meta: '{{\"security\":{\"function\":\"token_roles\",\"id\":\"application_read_security\",\"token\":{\"function\":\"bearer_token\",\"id\":\"application_read_bearer_token\"},\"roles\":[\"Administrator\",\"Account manager\",\"Application manager\",\"Developer\"]},\"process\":{\"function\":\"application_read\",\"id\":\"application_read_process\",\"accountIds\":{\"function\":\"var_get\",\"id\":\"application_read_account_ids\",\"nullable\":true,\"key\":\"account_ids\"},\"applicationNames\":{\"function\":\"var_get\",\"id\":\"application_read_application_names\",\"nullable\":true,\"key\":\"application_names\"},\"accountFilter\":{\"function\":\"var_get\",\"id\":\"application_read_account_filter\",\"nullable\":true,\"key\":\"account_filter\"},\"keyword\":{\"function\":\"var_get\",\"id\":\"application_read_keyword\",\"nullable\":true,\"key\":\"keyword\"},\"orderBy\":{\"function\":\"var_get\",\"id\":\"application_read_order_by\",\"nullable\":true,\"key\":\"order_by\"},\"direction\":{\"function\":\"var_get\",\"id\":\"application_read_direction\",\"nullable\":true,\"key\":\"direction\"}}}' }
    - { appid: 2, name: Application update, description: Update an application., method: put, uri: application, ttl: 0, meta: '{\"security\":{\"function\":\"token_roles\",\"id\":\"application_update_security\",\"token\":{\"function\":\"bearer_token\",\"id\":\"application_update_token\"},\"roles\":[\"Administrator\",\"Account manager\"]},\"process\":{\"function\":\"application_update\",\"id\":\"application_update_process\",\"appid\":{\"function\":\"var_uri\",\"id\":\"application_update_appid\",\"index\":0},\"accid\":{\"function\":\"var_uri\",\"id\":\"application_update_accid\",\"index\":1},\"name\":{\"function\":\"var_uri\",\"id\":\"application_update_name\",\"index\":2}}}' }
    - { appid: 2, name: User create, description: Create a user, method: post, uri: user, ttl: 0, meta: '{\"security\":{\"function\":\"TokenSysAdmin\",\"id\":1,\"token\":{\"function\":\"var_post\",\"id\":2,\"key\":\"token\"}},\"process\":{\"function\":\"datagatorUser\",\"id\":3,\"username\":{\"function\":\"var_post\",\"id\":4,\"key\":\"username\"},\"active\":{\"function\":\"var_post\",\"id\":5,\"key\":\"active\"},\"email\":{\"function\":\"var_post\",\"id\":6,\"key\":\"email\"},\"honorific\":{\"function\":\"var_post\",\"id\":7,\"key\":\"honorific\"},\"nameFirst\":{\"function\":\"var_post\",\"id\":8,\"key\":\"nameFirst\"},\"nameLast\":{\"function\":\"var_post\",\"id\":9,\"key\":\"nameLast\"},\"company\":{\"function\":\"var_post\",\"id\":10,\"key\":\"company\"}}}' }
    - { appid: 2, name: User update, description: Update a user, method: put, uri: user, ttl: 0, meta: '{\"security\":{\"function\":\"token_roles\",\"id\":\"user_update_security\",\"token\":{\"function\":\"bearer_token\",\"id\":\"user_update_token\"},\"roles\":[\"Administrator\",\"Account manager\",\"Application manager\"]},\"process\":{\"function\":\"user_update\",\"id\":\"user_update_process\",\"uid\":{\"function\":\"var_uri\",\"id\":\"user_update_uid\",\"index\":0},\"username\":{\"function\":\"var_get\",\"id\":\"user_update_username\",\"nullable\":true,\"key\":\"username\"},\"honorific\":{\"function\":\"var_get\",\"id\":\"user_update_honorific\",\"nullable\":true,\"key\":\"honorific\"},\"name_first\":{\"function\":\"var_get\",\"id\":\"user_update_name_first\",\"nullable\":true,\"key\":\"name_first\"},\"name_last\":{\"function\":\"var_get\",\"id\":\"user_update_name_last\",\"nullable\":true,\"key\":\"name_last\"},\"email\":{\"function\":\"var_get\",\"id\":\"user_update_email\",\"nullable\":true,\"key\":\"email\"},\"company\":{\"function\":\"var_get\",\"id\":\"user_update_company\",\"nullable\":true,\"key\":\"company\"},\"website\":{\"function\":\"var_get\",\"id\":\"user_update_website\",\"nullable\":true,\"key\":\"website\"},\"street_address\":{\"function\":\"var_get\",\"id\":\"user_update_street_address\",\"nullable\":true,\"key\":\"street_address\"},\"suburb\":{\"function\":\"var_get\",\"id\":\"user_update_suburb\",\"nullable\":true,\"key\":\"suburb\"},\"city\":{\"function\":\"var_get\",\"id\":\"user_update_city\",\"nullable\":true,\"key\":\"city\"},\"state\":{\"function\":\"var_get\",\"id\":\"user_update_state\",\"nullable\":true,\"key\":\"state\"},\"country\":{\"function\":\"var_get\",\"id\":\"user_update_country\",\"nullable\":true,\"key\":\"country\"},\"postcode\":{\"function\":\"var_get\",\"id\":\"user_update_postcode\",\"nullable\":true,\"key\":\"postcode\"},\"phone_mobile\":{\"function\":\"var_get\",\"id\":\"user_update_phone_mobile\",\"nullable\":true,\"key\":\"phone_mobile\"},\"phone_work\":{\"function\":\"var_get\",\"id\":\"user_update_phone_work\",\"nullable\":true,\"key\":\"phone_work\"}}}' }
    - { appid: 2, name: User delete, description: Delete a user, method: delete, uri: user, ttl: 0, meta: '{\"security\":{\"function\":\"TokenSysAdmin\",\"id\":1,\"token\":{\"function\":\"var_get\",\"id\":2,\"key\":\"token\"}},\"process\":{\"function\":\"datagatorUser\",\"id\":3,\"username\":{\"function\":\"var_get\",\"id\":4,\"key\":\"username\"}}}' }
    - { appid: 2, name: User read, description: Fetch a user, method: get, uri: user, ttl: 0, meta: '{\"security\":{\"function\":\"token_roles\",\"id\":\"user_read_security\",\"token\":{\"function\":\"bearer_token\",\"id\":\"user_read_token\"},\"roles\":[\"Administrator\",\"Account manager\",\"Application manager\",\"Developer\"]},\"process\":{\"function\":\"user_read\",\"id\":\"user_read_process\",\"uid\":{\"function\":\"var_get\",\"id\":\"user_read_uid\",\"nullable\":true,\"key\":\"uid\"},\"username\":{\"function\":\"var_get\",\"id\":\"user_read_username\",\"nullable\":true,\"key\":\"username\"},\"email\":{\"function\":\"var_get\",\"id\":\"user_read_email\",\"nullable\":true,\"key\":\"email\"},\"keyword\":{\"function\":\"var_get\",\"id\":\"user_read_keyword\",\"nullable\":true,\"key\":\"keyword\"},\"orderBy\":{\"function\":\"var_get\",\"id\":\"user_read_order_by\",\"nullable\":true,\"key\":\"order_by\"},\"direction\":{\"function\":\"var_get\",\"id\":\"user_read_direction\",\"nullable\":true,\"key\":\"direction\"}}}' }
    - { appid: 2, name: User Role create, description: Add a role for a user for an application, method: post, uri: userrole, ttl: 0, meta: '{\"security\":{\"function\":\"token_roles\",\"id\":\"user_role_create_security\",\"token\":{\"function\":\"bearer_token\",\"id\":\"user_role_create_token\"},\"roles\":[\"Administrator\",\"Account manager\",\"Application manager\"]},\"process\":{\"function\":\"user_role\",\"id\":\"user_role_create_user_role\",\"username\":{\"function\":\"var_post\",\"id\":\"user_role_create_username\",\"key\":\"username\"},\"accountName\":{\"function\":\"var_post\",\"id\":\"user_role_create_acc_name\",\"key\":\"accountName\"},\"applicationName\":{\"function\":\"var_post\",\"id\":\"user_role_create_app_name\",\"key\":\"applicationName\"},\"roleName\":{\"function\":\"var_post\",\"id\":\"user_role_create_role_name\",\"key\":\"roleName\"}}}' }
    - { appid: 2, name: User Role delete, description: Delete a role for a user an application, method: delete, uri: userrole, ttl: 0, meta: '{\"security\":{\"function\":\"token_roles\",\"id\":\"user_role_delete_security\",\"token\":{\"function\":\"bearer_token\",\"id\":\"user_role_delete_token\"},\"roles\":[\"Administrator\",\"Account manager\",\"Application manager\"]},\"process\":{\"function\":\"user_role\",\"id\":\"user_role_delete_user_role\",\"accountName\":{\"function\":\"var_uri\",\"id\":\"user_role_delete_acc_name\",\"index\":0},\"applicationName\":{\"function\":\"var_uri\",\"id\":\"user_role_delete_app_name\",\"index\":1},\"username\":{\"function\":\"var_uri\",\"id\":\"user_role_delete_username\",\"index\":2},\"roleName\":{\"function\":\"var_uri\",\"id\":\"user_role_delete_role_name\",\"index\":3}}}' }
    - { appid: 2, name: User Role read, description: Fetch all roles for a user., method: get, uri: userrole, ttl: 0, meta: '{\"security\":{\"function\":\"token_roles\",\"id\":\"user_role_read_security\",\"token\":{\"function\":\"bearer_token\",\"id\":\"user_role_read_token\"},\"roles\":[\"Administrator\",\"Account manager\",\"Application manager\"]},\"process\":{\"function\":\"user_role\",\"id\":\"user_role_read_user_role\",\"username\":{\"function\":\"var_get\",\"id\":\"user_role_read_username\",\"key\":\"username\"}}}' }
    - { appid: 2, name: Processors all, description: Fetch details of all procssors, method: get, uri: processors/all, ttl: 3600, meta: '{\"security\":{\"function\":\"tokenDeveloper\",\"id\":1,\"token\":{\"function\":\"var_get\",\"id\":2,\"key\":\"token\"}},\"process\":{\"function\":\"ProcessorsAll\",\"id\":3}}' }
    - { appid: 2, name: Resource delete, description: Delete a resource, method: delete, uri: resource, ttl: 0, meta: '{\"security\":{\"function\":\"tokenDeveloper\",\"id\":1,\"token\":{\"function\":\"varRequest\",\"id\":2,\"name\":\"token\"}},\"process\":{\"function\":\"resourceYaml\",\"id\":3,\"method\":{\"function\":\"varRequest\",\"id\":4,\"name\":\"method\"},\"uri\":{\"function\":\"varRequest\",\"id\":5,\"name\":\"uri\"}}}' }
    - { appid: 2, name: Resource export JSON, description: Export a resource in string or JSON format, method: get, uri: resource/json, ttl: 0, meta: '{\"security\":{\"function\":\"tokenDeveloper\",\"id\":1,\"token\":{\"function\":\"var_get\",\"id\":2,\"key\":\"token\"}},\"process\":{\"function\":\"resourceJson\",\"id\":3,\"method\":{\"function\":\"var_get\",\"id\":4,\"key\":\"method\"},\"noun\":{\"function\":\"var_get\",\"id\":5,\"key\":\"noun\"},\"verb\":{\"function\":\"var_get\",\"id\":6,\"key\":\"verb\"}}}' }
    - { appid: 2, name: Resource export YAML, description: Fetch a resource in string or YAML format, method: get, uri: resource/yaml, ttl: 0, meta: '{\"security\":{\"function\":\"tokenDeveloper\",\"id\":1,\"token\":{\"function\":\"var_get\",\"id\":2,\"key\":\"token\"}},\"process\":{\"function\":\"resourceYaml\",\"id\":3,\"method\":{\"function\":\"var_get\",\"id\":4,\"key\":\"method\"},\"noun\":{\"function\":\"var_get\",\"id\":5,\"key\":\"noun\"},\"verb\":{\"function\":\"var_get\",\"id\":6,\"key\":\"verb\"}}}' }
    - { appid: 2, name: Resource import JSON, description: Create a resource from a document or string in JSON format, method: post, uri: resource/json, ttl: 0, meta: '{\"security\":{\"function\":\"tokenDeveloper\",\"id\":1,\"token\":{\"function\":\"var_post\",\"id\":2,\"key\":\"token\"}},\"process\":{\"function\":\"resourceJson\",\"id\":3,\"yaml\":{\"function\":\"var_post\",\"id\":4,\"key\":\"yaml\"}}}' }
    - { appid: 2, name: Resource import Swagger, description: Create resource/s from a Swagger document, method: post, uri: resource/swagger, ttl: 0, meta: '{\"security\":{\"function\":\"tokenDeveloper\",\"id\":1,\"token\":{\"function\":\"var_post\",\"id\":2,\"key\":\"token\"}},\"process\":{\"function\":\"resourceSwagger\",\"id\":3,\"resource\":\"resource\"}}' }
    - { appid: 2, name: Resource import YAML, description: Create a resource from a document or string in YAML format, method: post, uri: resource/yaml, ttl: 0, meta: '{\"security\":{\"function\":\"token_role\",\"id\":\"resource_import_yaml_security\",\"token\":{\"function\":\"bearer_token\",\"id\":\"resource_import_yaml_token\"},\"role\":\"Developer\"},\"process\":{\"function\":\"resource_yaml\",\"id\":\"resource_import_yaml_rsesource_yaml\",\"resourceString\":{\"function\":\"var_body\",\"id\":\"resource_import_yaml_resource_string\"},\"accName\":{\"function\":\"var_uri\",\"id\":\"resource_import_yaml_acc_name\",\"index\":0},\"appName\":{\"function\":\"var_uri\",\"id\":\"resource_import_yaml_app_name\",\"index\":1}}}' }
    - { appid: 2, name: User login, description: Login a user to GaterData, method: post, uri: login, ttl: 0, meta: '{\"process\":{\"function\":\"user_login\",\"id\":1,\"username\":{\"function\":\"var_post\",\"id\":2,\"key\":\"username\"},\"password\":{\"function\":\"var_post\",\"id\":3,\"key\":\"password\"}}}' }

external_user:
  columns:
    euid: { type: int(10) unsigned, notnull: true, primary: true, autoincrement: true, comment: external user id }
    appid: { type: int(10) unsigned, notnull: true, comment: application id }
    external_id: { type: varchar(255), notnull: true, comment: user id in external entity }
    external_entity: { type: varchar(255), notnull: true, comment: name of the external entity }
    data_field_1: { type: varchar(255), notnull: false, comment: extra data field 1 }
    data_field_2: { type: varchar(255), notnull: false, comment: extra data field 2 }
    data_field_3: { type: varchar(255), notnull: false, comment: extra data field 3 }

blacklist:
  columns:
    blid: { type: int(10) unsigned, notnull: true, primary: true, autoincrement: true, comment: blacklist id }
    appid: { type: int(10) unsigned, notnull: true, comment: application id }
    min_ip: { type: varchar(32), notnull: true, comment: ip range minimum }
    max_ip: { type: varchar(32), notnull: true, comment: ip range maximum }

whitelist:
  columns:
    wlid: { type: int(10) unsigned, notnull: true, primary: true, autoincrement: true, comment: whitelist id }
    appid: { type: int(10) unsigned, notnull: true, comment: application id }
    min_ip: { type: varchar(32), notnull: true, comment: ip range minimum }
    max_ip: { type: varchar(32), notnull: true, comment: ip range maximum }

log:
  columns:
    lid: { type: int(10) unsigned, notnull: true, primary: true, autoincrement: true, comment: log id }
    datetime: { type: timestamp, notnull: true, default: CURRENT_TIMESTAMP, comment: log time and date }
    user: { type: varchar(255), notnull: true, comment: user name }
    ip: { type: varchar(11), notnull: true, comment: user id }
    type: { type: varchar(64), notnull: true, comment: call type }
    text: { type: varchar(1024), notnull: true, comment: log text }

var:
  columns:
    vid: { type: int(10) unsigned, notnull: true, primary: true, autoincrement: true, comment: var id }
    appid: { type: int(10) unsigned, notnull: true, comment: application id }
    name: { type: varchar(255), notnull: true, comment: name of the var }
    val: { type: varchar(255), notnull: true, comment: value of the var }
